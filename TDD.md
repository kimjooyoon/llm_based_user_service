# 테스트 주도 개발(TDD) 원칙

## 기본 원칙

1. **레드-그린-리팩터 사이클 준수**
   - 레드(Red): 실패하는 테스트 작성
   - 그린(Green): 테스트를 통과하는 가장 간단한 코드 구현
   - 리팩터(Refactor): 중복 제거, 가독성 개선 등의 코드 개선

2. **도메인 모델 먼저 테스트**
   - 도메인 로직에 대한 단위 테스트를 우선 작성
   - 외부 의존성(DB, API 등)을 갖지 않는 POJO 클래스부터 개발

3. **테스트 우선 설계**
   - 구현 전 테스트 케이스 먼저 작성
   - 인터페이스와 API 설계를 테스트로 검증

4. **상향식 개발 접근법**
   - 하위 레벨 컴포넌트부터 테스트 및 개발
   - 점진적으로 상위 레벨 컴포넌트 개발

## 테스트 종류별 구현 지침

### 단위 테스트 (Unit Test)
- 각 도메인 모델, 서비스, 유틸리티 클래스에 대한 단위 테스트 작성
- 모킹(Mockito) 활용하여 외부 의존성 분리
- 각 메소드의 핵심 로직 및 예외 상황 테스트
- Naming Convention: `should{ExpectedBehavior}_when{StateUnderTest}`

### 통합 테스트 (Integration Test)
- 여러 컴포넌트 간의 상호작용 테스트
- DB 접근, 메시지 큐 통합 등의 외부 시스템 연동 테스트
- Spring Boot Test Framework 활용

### API 테스트
- RESTful API 엔드포인트에 대한 테스트
- MockMvc 또는 RestAssured 활용
- 각 API의 성공/실패 케이스 검증

## 도메인 주도 설계(DDD)와 TDD 결합

1. **Aggregate Root 중심 테스트**
   - 각 Aggregate Root 엔티티에 대한 테스트 우선 작성
   - 비즈니스 규칙과 일관성 검증

2. **이벤트 기반 테스트**
   - 도메인 이벤트 발행 및 구독 메커니즘 테스트
   - 이벤트 핸들러 및 리스너 동작 검증

3. **Repository 테스트**
   - Repository 인터페이스 구현체에 대한 테스트
   - 영속성 테스트는 H2 등의 인메모리 DB 활용

## 코드 품질 지표

1. **테스트 커버리지**
   - 코드 라인 커버리지 80% 이상 유지
   - 분기 커버리지(Branch Coverage) 중시

2. **테스트 실행 속도**
   - 단위 테스트는 빠르게 실행되도록 구현
   - 느린 테스트는 별도 프로파일로 분리

3. **테스트 독립성**
   - 테스트 간 의존성 없이 독립적으로 실행 가능하도록 구현
   - 테스트 순서에 영향받지 않는 설계

## 지속적 통합(CI) 및 배포(CD) 연계

1. **모든 PR은 테스트 통과 필수**
   - Pull Request 시 모든 테스트 자동 실행
   - 실패 시 머지 블록

2. **브랜치별 테스트 전략**
   - feature 브랜치: 단위 테스트
   - develop 브랜치: 단위 + 통합 테스트
   - main 브랜치: 전체 테스트 스위트

3. **배포 전 테스트 확인**
   - 스테이징 환경에서 E2E 테스트 실행
   - 성능 테스트 및 보안 테스트 수행